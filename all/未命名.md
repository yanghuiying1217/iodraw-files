```mermaid
graph TD
    A[启动应用] --> B[初始化阶段]
    B --> B1[初始化日志系统]
    B --> B2[初始化TTS/ASR模型]
    B2 --> B3[语音克隆]
    B3 --> B4[加载参考音频]
    B4 --> B5[ASR转写提示文本]
    B5 --> B6[TTS模型初始化]

    A --> C[WebSocket连接]
    C --> D{等待连接}
    D --> |连接建立| E[创建项目路径]
    E --> F{消息循环}
    
    F --> G[接收消息]
    G --> H[解析JSON数据]
    H --> I{检查choices有效性}
    I --> |无效| J[发送继续等待响应]
    I --> |有效| K[提取文本内容]
    
    K --> L[文本缓冲区处理]
    L --> M[句子分割处理]
    M --> N{处理完成判断}
    N --> |未完成| O[累积到句子缓冲区]
    N --> |完成| P[处理最终缓冲区]
    
    O --> Q{缓冲区达到阈值?}
    Q --> |是| R[调用TTS生成语音]
    Q --> |否| F
    
    R --> S[保存语音文件]
    S --> T[发送成功响应]
    T --> U[重置缓冲区]
    U --> F
    
    P --> V[调用TTS生成最终语音]
    V --> W[发送最终响应]
    W --> X[关闭连接]
    
    style A fill:#4CAF50,stroke:#388E3C
    style B fill:#2196F3,stroke:#1976D2
    style C fill:#9C27B0,stroke:#7B1FA2
    style F fill:#FF9800,stroke:#F57C00
    style R fill:#E91E63,stroke:#C2185B
    style X fill:#607D8B,stroke:#455A64

    classDef process fill:#f9f,stroke:#333;
    classDef decision fill:#f96,stroke:#333;
    classDef terminal fill:#4CAF50,stroke:#388E3C;
    classDef subgraph fill:#fff,stroke:#bbb;
    
  
```